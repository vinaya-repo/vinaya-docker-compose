trigger:
- main

resources:
- repo: self

variables:
  dockerHubImage: 'vinayasrri/myrepo:1.0.0'  # Replace with your Docker Hub username, image name, and tag
  # Container registry service connection established during pipeline creation
  dockerRegistryServiceConnection: '472eab1a-42b9-4566-bdea-8dc3c0bec794'
  imageRepository: 'vinaya-repo'
  containerRegistry: 'myregistry9.azurecr.io'
  dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile'
  tag: '$(Build.BuildId)'

# Agent self hosted image name
pool:
  name: 'mypool'

stages:
- stage: Build
  displayName: Build and push stage
  jobs:
  - job: Build
    displayName: Build and push Docker image
    pool:
      name: 'mypool'
    steps:
    - script: |
        # Pull the image from Docker Hub
        docker pull $(dockerHubImage)

        # Login to Azure Container Registry
        docker login -u YourACRUsername -p YourACRPassword YourACRName.azurecr.io

        # Tag the pulled image with ACR repository and tag
        docker tag $(dockerHubImage) YourACRName.azurecr.io/$(imageRepository):$(tag)

        # Push the tagged image to ACR
        docker push YourACRName.azurecr.io/$(imageRepository):$(tag)
      displayName: Pull Docker image from Docker Hub and push to Azure Container Registry
